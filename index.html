<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced Media Player with Gemini AI</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- Iconify -->
    <script src="https://code.iconify.design/iconify-icon/1.0.7/iconify-icon.min.js"></script>
    <!-- HLS.js for HLS Streaming -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <!-- Dash.js for DASH Streaming -->
    <script src="https://cdn.dashjs.org/latest/dash.all.min.js"></script>

    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        /* Hide default video controls */
        video::-webkit-media-controls { display: none !important; }
        video::-moz-media-controls { display: none !important; }
        video::media-controls { display: none !important; }

        /* Custom progress bar styling */
        .progress-bar {
            -webkit-appearance: none; appearance: none;
            width: 100%; height: 5px;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 5px; outline: none; cursor: pointer;
            transition: height 0.15s ease-in-out;
        }
        .progress-bar:hover { height: 8px; }
        .progress-bar::-webkit-slider-thumb {
            -webkit-appearance: none; appearance: none;
            width: 16px; height: 16px;
            background: #3b82f6; border-radius: 50%;
            cursor: pointer; border: 2px solid white;
            transform: scale(0);
            transition: transform 0.15s ease-in-out;
        }
        /* Use media-container class for hover effects */
        .media-container:hover .progress-bar::-webkit-slider-thumb,
        .progress-bar:active::-webkit-slider-thumb {
            transform: scale(1);
        }
        .progress-bar::-moz-range-thumb {
            width: 16px; height: 16px;
            background: #3b82f6; border-radius: 50%;
            cursor: pointer; border: 2px solid white;
        }

        /* Custom volume slider styling */
        .volume-slider {
            -webkit-appearance: none; appearance: none;
            background: rgba(255, 255, 255, 0.3);
            outline: none; border-radius: 5px;
            transition: all 0.2s;
        }
        .volume-slider::-webkit-slider-thumb {
            -webkit-appearance: none; appearance: none;
            width: 14px; height: 14px;
            background: white; border-radius: 50%;
            cursor: pointer;
        }

        /* Controls visibility */
        .controls-container {
            opacity: 0;
            transition: opacity 0.3s ease-in-out;
        }
        .media-container:hover .controls-container,
        .media-container.paused .controls-container,
        .media-container.controls-active .controls-container {
            opacity: 1;
        }
        
        /* Custom Loader */
        .loader {
            border: 5px solid #f3f3f3;
            border-top: 5px solid #3b82f6;
            border-radius: 50%;
            width: 50px; height: 50px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Settings Menu */
        .settings-menu { display: none; }
        .settings-btn.active + .settings-menu,
        .settings-menu:hover { display: block; }
        
        iconify-icon { font-size: 24px; }
        
        /* AI Modal */
        #ai-modal-content .timestamp {
            cursor: pointer;
            text-decoration: underline;
            color: #60a5fa; /* blue-400 */
        }
        #ai-modal-content .timestamp:hover {
            color: #3b82f6; /* blue-600 */
        }

        /* Audio Player Specific Styles */
        #audio-art {
            display: none; /* Hidden by default */
        }
        .media-container.is-audio {
            background-color: #000; /* Black background for audio */
        }
        /* FIX: Make video element invisible but functional for audio playback */
        .media-container.is-audio #video {
            opacity: 0;
            pointer-events: none;
        }
        .media-container.is-audio #audio-art {
            display: flex;
        }
    </style>
</head>
<body class="bg-gray-900 text-white flex flex-col items-center justify-center min-h-screen p-4">

    <div class="w-full max-w-5xl mx-auto">
        <h1 class="text-3xl font-bold text-center mb-4">Advanced Media Player with Gemini AI</h1>

        <!-- Media Input Section -->
        <div class="bg-gray-800 p-4 rounded-lg mb-4 flex flex-col sm:flex-row gap-4 items-center">
            <div class="w-full">
                <label for="media-upload" class="block text-sm font-medium mb-2">Upload Media File</label>
                <input type="file" id="media-upload" accept="video/*,audio/*,application/x-mpegURL,application/dash+xml" class="block w-full text-sm text-gray-400 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-blue-600 file:text-white hover:file:bg-blue-700">
            </div>
            <div class="w-full">
                <label for="media-url" class="block text-sm font-medium mb-2">Or Enter Media URL (MP4, MP3, HLS, DASH)</label>
                <div class="flex gap-2">
                    <input type="url" id="media-url" placeholder="https://dash.akamaized.net/envivio/EnvivioDash3/manifest.mpd" class="w-full bg-gray-700 border border-gray-600 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500">
                    <button id="load-url-btn" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg">Load</button>
                </div>
            </div>
        </div>

        <!-- Media Player -->
        <div id="media-container" class="media-container relative w-full bg-black rounded-lg overflow-hidden shadow-2xl aspect-video flex items-center justify-center">
            <video id="video" class="w-full h-full block" playsinline></video>
            
            <!-- Art for Audio files - Now displays title text -->
            <div id="audio-art" class="absolute inset-0 items-center justify-center text-gray-400 p-8">
                <p id="audio-title" class="text-3xl font-bold text-center"></p>
            </div>

            <!-- Custom Loader -->
            <div id="loader" class="loader absolute top-1/2 left-1/2 -mt-6 -ml-6 hidden"></div>

            <!-- Custom Controls -->
            <div class="controls-container absolute bottom-0 left-0 right-0 p-4 bg-gradient-to-t from-black/70 to-transparent">
                <!-- Progress Bar -->
                <input type="range" id="progress-bar" class="progress-bar w-full" value="0" min="0" max="100" step="0.1">

                <!-- Bottom Controls -->
                <div class="flex items-center justify-between mt-2">
                    <!-- Left Controls -->
                    <div class="flex items-center gap-4">
                        <button id="play-pause-btn" class="text-white"><iconify-icon id="play-icon" icon="mdi:play"></iconify-icon><iconify-icon id="pause-icon" icon="mdi:pause" class="hidden"></iconify-icon></button>
                        <div class="flex items-center gap-2">
                            <button id="volume-btn"><iconify-icon id="volume-high-icon" icon="mdi:volume-high"></iconify-icon><iconify-icon id="volume-muted-icon" icon="mdi:volume-off" class="hidden"></iconify-icon></button>
                            <input type="range" id="volume-slider" class="volume-slider w-24 h-1.5" min="0" max="1" step="0.01" value="1">
                        </div>
                        <div class="text-sm"><span id="current-time">00:00</span> / <span id="duration">00:00</span></div>
                    </div>
                    
                    <!-- Center Controls (Skip) -->
                    <div class="flex items-center gap-2">
                        <button class="skip-btn p-1 rounded-md hover:bg-white/20" data-skip="-30" title="-30s"><iconify-icon icon="mdi:rewind-30"></iconify-icon></button>
                        <button class="skip-btn p-1 rounded-md hover:bg-white/20" data-skip="-10" title="-10s"><iconify-icon icon="mdi:rewind-10"></iconify-icon></button>
                        <button class="skip-btn p-1 rounded-md hover:bg-white/20" data-skip="10" title="+10s"><iconify-icon icon="mdi:fast-forward-10"></iconify-icon></button>
                        <button class="skip-btn p-1 rounded-md hover:bg-white/20" data-skip="30" title="+30s"><iconify-icon icon="mdi:fast-forward-30"></iconify-icon></button>
                    </div>

                    <!-- Right Controls -->
                    <div class="flex items-center gap-4">
                        <!-- Gemini AI Button -->
                        <button id="gemini-btn" class="text-white" title="âœ¨ AI Features"><iconify-icon icon="mdi:sparkles"></iconify-icon></button>

                        <button id="loop-btn" class="opacity-50" title="Loop"><iconify-icon icon="mdi:repeat"></iconify-icon></button>
                        <button id="autoplay-btn" class="opacity-50" title="Autoplay"><iconify-icon icon="mdi:play-box-multiple"></iconify-icon></button>
                        <div class="relative">
                            <button class="settings-btn" title="Settings"><iconify-icon icon="mdi:cog"></iconify-icon></button>
                            <div class="settings-menu absolute bottom-full right-0 mb-2 bg-gray-800/90 backdrop-blur-sm rounded-lg p-4 w-60 shadow-lg">
                                <div class="setting-item mb-3">
                                    <label class="text-sm font-medium">Playback Speed</label>
                                    <select id="playback-speed" class="w-full mt-1 bg-gray-700 border border-gray-600 rounded px-2 py-1 text-sm"><option value="0.25">0.25x</option><option value="0.5">0.5x</option><option value="0.75">0.75x</option><option value="1" selected>Normal</option><option value="1.25">1.25x</option><option value="1.5">1.5x</option><option value="2">2x</option><option value="3">3x</option><option value="5">5x</option></select>
                                </div>
                                <div id="brightness-setting" class="setting-item mb-3">
                                    <label class="text-sm font-medium">Brightness</label>
                                    <input type="range" id="brightness-slider" class="w-full mt-1" min="0.2" max="2" step="0.1" value="1">
                                </div>
                                <div id="quality-menu" class="setting-item mb-3 hidden">
                                    <label class="text-sm font-medium">Quality</label>
                                    <select id="quality-selector" class="w-full mt-1 bg-gray-700 border border-gray-600 rounded px-2 py-1 text-sm"></select>
                                </div>
                                <div id="subtitle-menu" class="setting-item mb-3 hidden">
                                    <label class="text-sm font-medium">Subtitles</label>
                                    <select id="subtitle-selector" class="w-full mt-1 bg-gray-700 border border-gray-600 rounded px-2 py-1 text-sm"></select>
                                </div>
                                <div id="audio-menu" class="setting-item hidden">
                                    <label class="text-sm font-medium">Audio</label>
                                    <select id="audio-selector" class="w-full mt-1 bg-gray-700 border border-gray-600 rounded px-2 py-1 text-sm"></select>
                                </div>
                            </div>
                        </div>
                        <a id="download-btn" href="#" download class="text-white" title="Download"><iconify-icon icon="mdi:download"></iconify-icon></a>
                        <button id="fullscreen-btn" class="text-white" title="Fullscreen"><iconify-icon id="fullscreen-open-icon" icon="mdi:fullscreen"></iconify-icon><iconify-icon id="fullscreen-close-icon" icon="mdi:fullscreen-exit" class="hidden"></iconify-icon></button>
                    </div>
                </div>
            </div>
        </div>
        <div class="text-center mt-2 text-xs text-gray-500">
            <p>Quality switching requires an HLS (.m3u8) or DASH (.mpd) stream. A sample DASH URL is provided.</p>
        </div>
    </div>

    <!-- Gemini AI Modal -->
    <div id="ai-modal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center p-4 hidden z-50">
        <div class="bg-gray-800 rounded-lg shadow-2xl w-full max-w-2xl max-h-[80vh] flex flex-col">
            <div class="flex justify-between items-center p-4 border-b border-gray-700">
                <h3 class="text-lg font-bold">âœ¨ AI Features</h3>
                <button id="ai-modal-close" class="text-gray-400 hover:text-white">&times;</button>
            </div>
            <div class="p-6 flex-grow overflow-y-auto">
                <div id="ai-modal-content">
                    <!-- Content will be injected here by JS -->
                </div>
            </div>
             <div class="p-4 border-t border-gray-700 flex justify-end gap-3">
                <button id="ai-summarize-btn" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg">Summarize Media</button>
                <button id="ai-timestamps-btn" class="bg-purple-600 hover:bg-purple-700 text-white font-bold py-2 px-4 rounded-lg">Find Key Moments</button>
            </div>
            <div class="text-center p-2 text-xs text-gray-500">AI-generated content may be inaccurate.</div>
        </div>
    </div>

    <script>
        // DOM Elements
        const mediaContainer = document.getElementById('media-container');
        const video = document.getElementById('video'); // Still using <video> tag for audio
        const audioTitleEl = document.getElementById('audio-title');
        const playPauseBtn = document.getElementById('play-pause-btn');
        const playIcon = document.getElementById('play-icon');
        const pauseIcon = document.getElementById('pause-icon');
        const volumeBtn = document.getElementById('volume-btn');
        const volumeHighIcon = document.getElementById('volume-high-icon');
        const volumeMutedIcon = document.getElementById('volume-muted-icon');
        const volumeSlider = document.getElementById('volume-slider');
        const progressBar = document.getElementById('progress-bar');
        const currentTimeEl = document.getElementById('current-time');
        const durationEl = document.getElementById('duration');
        const skipButtons = document.querySelectorAll('.skip-btn');
        const loopBtn = document.getElementById('loop-btn');
        const autoplayBtn = document.getElementById('autoplay-btn');
        const playbackSpeedSelect = document.getElementById('playback-speed');
        const brightnessSetting = document.getElementById('brightness-setting');
        const brightnessSlider = document.getElementById('brightness-slider');
        const fullscreenBtn = document.getElementById('fullscreen-btn');
        const fullscreenOpenIcon = document.getElementById('fullscreen-open-icon');
        const fullscreenCloseIcon = document.getElementById('fullscreen-close-icon');
        const mediaUpload = document.getElementById('media-upload');
        const mediaUrlInput = document.getElementById('media-url');
        const loadUrlBtn = document.getElementById('load-url-btn');
        const downloadBtn = document.getElementById('download-btn');
        const loader = document.getElementById('loader');
        const settingsBtn = document.querySelector('.settings-btn');

        // Menu Elements
        const qualityMenu = document.getElementById('quality-menu');
        const qualitySelector = document.getElementById('quality-selector');
        const subtitleMenu = document.getElementById('subtitle-menu');
        const subtitleSelector = document.getElementById('subtitle-selector');
        const audioMenu = document.getElementById('audio-menu');
        const audioSelector = document.getElementById('audio-selector');

        // Gemini AI Elements
        const geminiBtn = document.getElementById('gemini-btn');
        const aiModal = document.getElementById('ai-modal');
        const aiModalClose = document.getElementById('ai-modal-close');
        const aiModalContent = document.getElementById('ai-modal-content');
        const aiSummarizeBtn = document.getElementById('ai-summarize-btn');
        const aiTimestampsBtn = document.getElementById('ai-timestamps-btn');

        let controlsTimeout;
        let hls;
        let dashPlayer;
        let currentMediaTitle = "this media";

        // --- Core Functions ---
        function togglePlay() { if (video.paused) { video.play(); } else { video.pause(); } }
        function updatePlayPauseIcon() {
            if (video.paused) {
                playIcon.classList.remove('hidden'); pauseIcon.classList.add('hidden');
                mediaContainer.classList.add('paused');
            } else {
                playIcon.classList.add('hidden'); pauseIcon.classList.remove('hidden');
                mediaContainer.classList.remove('paused');
            }
        }
        function handleVolumeChange() { video.volume = volumeSlider.value; video.muted = volumeSlider.value === '0'; }
        function updateVolumeIcon() {
            if (video.muted || video.volume === 0) {
                volumeHighIcon.classList.add('hidden'); volumeMutedIcon.classList.remove('hidden');
            } else {
                volumeHighIcon.classList.remove('hidden'); volumeMutedIcon.classList.add('hidden');
            }
        }
        function toggleMute() {
            video.muted = !video.muted;
            if (video.muted) { volumeSlider.value = 0; } 
            else { volumeSlider.value = video.volume > 0 ? video.volume : 1; }
            handleVolumeChange();
        }
        function updateProgress() {
            const value = (video.currentTime / video.duration) * 100 || 0;
            progressBar.value = value;
            progressBar.style.background = `linear-gradient(to right, #3b82f6 ${value}%, rgba(255, 255, 255, 0.3) ${value}%)`;
            currentTimeEl.textContent = formatTime(video.currentTime);
        }
        function setProgress(e) { video.currentTime = (e.target.value / 100) * video.duration; }
        function formatTime(time) {
            if (isNaN(time)) return '00:00';
            const minutes = Math.floor(time / 60);
            const seconds = Math.floor(time % 60);
            return `${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
        }
        function skip() { video.currentTime += parseFloat(this.dataset.skip); }

        // --- Advanced Features ---
        function toggleLoop() { video.loop = !video.loop; loopBtn.classList.toggle('opacity-50', !video.loop); loopBtn.classList.toggle('text-blue-400', video.loop); }
        function toggleAutoplay() { video.autoplay = !video.autoplay; autoplayBtn.classList.toggle('opacity-50', !video.autoplay); autoplayBtn.classList.toggle('text-blue-400', video.autoplay); }
        function setPlaybackSpeed() { video.playbackRate = parseFloat(playbackSpeedSelect.value); }
        function setBrightness() { video.style.filter = `brightness(${brightnessSlider.value})`; }
        function toggleFullscreen() {
            if (!document.fullscreenElement) { mediaContainer.requestFullscreen().catch(err => console.error(`Fullscreen error: ${err.message}`)); } 
            else { document.exitFullscreen(); }
        }
        function updateFullscreenIcon() {
             if (!document.fullscreenElement) {
                fullscreenOpenIcon.classList.remove('hidden'); fullscreenCloseIcon.classList.add('hidden');
            } else {
                fullscreenOpenIcon.classList.add('hidden'); fullscreenCloseIcon.classList.remove('hidden');
            }
        }

        // --- Media Loading & Streaming Engine ---
        function loadMedia(src, file = null) {
            let title = "this media";
            let isAudio = false;

            if (file) {
                title = file.name.replace(/\.[^/.]+$/, "").replace(/_/g, ' ');
                isAudio = file.type.startsWith('audio/');
            } else {
                title = src.substring(src.lastIndexOf('/') + 1).replace(/\.[^/.]+$/, "").replace(/[-_]/g, ' ');
                const extension = src.split('.').pop().toLowerCase();
                isAudio = ['mp3', 'wav', 'ogg', 'm4a'].includes(extension);
            }
            
            currentMediaTitle = title;
            mediaContainer.classList.toggle('is-audio', isAudio);
            brightnessSetting.classList.toggle('hidden', isAudio);
            qualityMenu.classList.add('hidden'); // Always hide quality initially
            
            if (isAudio) {
                audioTitleEl.textContent = title;
            }

            // Clean up previous instances
            if (hls) { hls.destroy(); hls = null; }
            if (dashPlayer) { dashPlayer.reset(); dashPlayer = null; }
            const currentSrc = video.getAttribute('src');
            if (currentSrc && currentSrc.startsWith('blob:')) { URL.revokeObjectURL(currentSrc); }

            // Hide optional menus
            subtitleMenu.classList.add('hidden');
            audioMenu.classList.add('hidden');

            if (!isAudio && src.includes('.m3u8')) {
                if (Hls.isSupported()) {
                    hls = new Hls();
                    hls.loadSource(src);
                    hls.attachMedia(video);
                    hls.on(Hls.Events.MANIFEST_PARSED, (event, data) => setupHlsQualityMenu(data.levels));
                    downloadBtn.style.display = 'none';
                } else if (video.canPlayType('application/vnd.apple.mpegurl')) {
                    video.src = src;
                }
            } else if (!isAudio && src.includes('.mpd')) {
                dashPlayer = dash.MediaPlayer().create();
                dashPlayer.initialize(video, src, video.autoplay);
                dashPlayer.on(dash.MediaPlayer.events.STREAM_INITIALIZED, setupDashQualityMenu);
                downloadBtn.style.display = 'none';
            } else {
                // Standard video/audio file (MP4, WebM, MP3, etc.)
                video.src = src;
                downloadBtn.href = src;
                downloadBtn.style.display = 'block';
            }
            if(video.autoplay) video.play();
        }

        function handleFileUpload(e) {
            const file = e.target.files[0];
            if (file) {
                const fileURL = URL.createObjectURL(file);
                loadMedia(fileURL, file);
                downloadBtn.download = file.name;
            }
        }
        function handleUrlLoad() {
            const url = mediaUrlInput.value.trim();
            if (url) { 
                loadMedia(url); 
                downloadBtn.download = 'media'; 
            }
        }
        
        // --- Track & Quality Management ---
        function setupHlsQualityMenu(levels) { /* Unchanged from previous version */ }
        function setupDashQualityMenu() { /* Unchanged */ }
        function changeQuality() { /* Unchanged */ }
        function setupTracks() { /* Unchanged */ }
        function changeSubtitle() { /* Unchanged */ }
        function changeAudioTrack() { /* Unchanged */ }

        // --- Gemini AI Integration ---
        async function callGeminiAPI(prompt) { /* Unchanged */ }
        function formatAIResponse(text) { /* Unchanged */ }
        function handleTimestampClick(e) { /* Unchanged */ }

        // --- UI/UX Functions ---
        function hideControls() { if (video.paused) return; mediaContainer.classList.remove('controls-active'); }
        function showControls() {
            mediaContainer.classList.add('controls-active');
            clearTimeout(controlsTimeout);
            controlsTimeout = setTimeout(hideControls, 3000);
        }

        // --- Event Listeners ---
        video.addEventListener('play', updatePlayPauseIcon);
        video.addEventListener('pause', updatePlayPauseIcon);
        video.addEventListener('click', togglePlay);
        video.addEventListener('timeupdate', updateProgress);
        video.addEventListener('loadedmetadata', () => { durationEl.textContent = formatTime(video.duration); setupTracks(); });
        video.addEventListener('volumechange', updateVolumeIcon);
        video.addEventListener('waiting', () => loader.classList.remove('hidden'));
        video.addEventListener('canplay', () => loader.classList.add('hidden'));
        
        playPauseBtn.addEventListener('click', (e) => { e.stopPropagation(); togglePlay(); });
        volumeBtn.addEventListener('click', (e) => { e.stopPropagation(); toggleMute(); });
        volumeSlider.addEventListener('input', handleVolumeChange);
        progressBar.addEventListener('input', setProgress);
        skipButtons.forEach(button => button.addEventListener('click', (e) => { e.stopPropagation(); skip.call(button); }));
        loopBtn.addEventListener('click', (e) => { e.stopPropagation(); toggleLoop(); });
        autoplayBtn.addEventListener('click', (e) => { e.stopPropagation(); toggleAutoplay(); });
        playbackSpeedSelect.addEventListener('change', setPlaybackSpeed);
        brightnessSlider.addEventListener('input', setBrightness);
        fullscreenBtn.addEventListener('click', (e) => { e.stopPropagation(); toggleFullscreen(); });
        document.addEventListener('fullscreenchange', updateFullscreenIcon);
        mediaUpload.addEventListener('change', handleFileUpload);
        loadUrlBtn.addEventListener('click', handleUrlLoad);
        qualitySelector.addEventListener('change', changeQuality);
        subtitleSelector.addEventListener('change', changeSubtitle);
        audioSelector.addEventListener('change', changeAudioTrack);
        
        mediaContainer.addEventListener('mousemove', showControls);
        mediaContainer.addEventListener('mouseleave', () => { clearTimeout(controlsTimeout); controlsTimeout = setTimeout(hideControls, 500); });
        settingsBtn.addEventListener('click', (e) => { e.stopPropagation(); settingsBtn.classList.toggle('active'); });
        document.addEventListener('click', (e) => {
            const settingsMenuEl = document.querySelector('.settings-menu');
            if (settingsMenuEl && !settingsBtn.contains(e.target) && !settingsMenuEl.contains(e.target)) { settingsBtn.classList.remove('active'); }
        });

        // Gemini AI Event Listeners
        geminiBtn.addEventListener('click', (e) => {
            e.stopPropagation();
            aiModal.classList.remove('hidden');
            aiModalContent.innerHTML = `<p>What would you like to know about "${currentMediaTitle}"?</p>`;
        });
        aiModalClose.addEventListener('click', () => aiModal.classList.add('hidden'));
        aiModal.addEventListener('click', (e) => { if (e.target === aiModal) { aiModal.classList.add('hidden'); }});
        aiSummarizeBtn.addEventListener('click', () => {
            const prompt = `Provide a concise, one-paragraph summary for a media file titled "${currentMediaTitle}".`;
            callGeminiAPI(prompt);
        });
        aiTimestampsBtn.addEventListener('click', () => {
            const prompt = `Analyze the title of a media file, "${currentMediaTitle}", which is ${formatTime(video.duration)} long. Based on the title, generate a list of key moments or chapters with timestamps. For example: "00:30 - Introduction", "05:15 - Main Topic". If the title is too generic, create a plausible chapter list for a media file of that length.`;
            callGeminiAPI(prompt);
        });
        aiModalContent.addEventListener('click', handleTimestampClick);

    </script>
</body>
</html>
